<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Performance Dashboard</title>
<style>
:root {
  --whoop-yellow: #f1c40f;
  --whoop-green: #2ecc71;
  --whoop-red: #e74c3c;
  --bg-dark: #121212;
  --card-bg: #1e1e1e;
  --text-main: #ffffff;
  --text-dim: #b3b3b3;
  --accent: #3498db;
}
* { box-sizing: border-box; }
html,body { height: 100%; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background-color: var(--bg-dark);
  color: var(--text-main);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
header {
  padding: 18px 20px;
  background-color: var(--card-bg);
  border-bottom: 1px solid #333;
  text-align: center;
  position: relative;
}
.header-title {
  font-weight: 700;
  letter-spacing: 1px;
}
.status-bar {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.82rem;
  font-weight: 700;
  margin-top: 10px;
}
.yellow {
  background-color: rgba(241,196,15,0.12);
  color: var(--whoop-yellow);
  border: 1px solid rgba(241,196,15,0.25);
}
.change-day-btn {
  position: absolute;
  right: 14px;
  top: 18px;
  background: transparent;
  border: 1px solid #333;
  padding: 6px 10px;
  border-radius: 8px;
  color: var(--text-dim);
  cursor: pointer;
  font-size: 0.85rem;
}
main {
  flex: 1;
  overflow-y: auto;
  padding: 18px;
  padding-bottom: 96px;
  max-width: 900px;
  margin: 0 auto;
  width: 100%;
}
.view { display: none; }
.view.active { display: block; }
.card {
  background-color: var(--card-bg);
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 14px;
  border: 1px solid #333;
  cursor: pointer;
  transition: transform 0.12s, box-shadow 0.12s;
}
.card:active { transform: scale(0.995); }
.card:focus { outline: 2px solid rgba(52,152,219,0.2); }
.meal-time { font-size: 0.76rem; color: var(--text-dim); margin-bottom: 6px; }
.meal-name { font-size: 1.12rem; font-weight: 700; margin-bottom: 10px; }
.macro-row {
  display: flex;
  justify-content: space-between;
  font-size: 0.88rem;
  border-top: 1px solid #333;
  padding-top: 10px;
  gap: 12px;
  align-items: center;
}
.macro-val { color: var(--accent); font-weight: 700; }
.recipe-detail {
  display: none;
  padding: 10px 0;
  font-size: 0.92rem;
  line-height: 1.45;
  color: var(--text-dim);
  border-top: 1px dashed #444;
  margin-top: 10px;
}
.recipe-detail.show { display: block; }
.shopping-list { list-style: none; padding: 0; margin: 0; }
.shopping-item {
  display: flex;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid #333;
  gap: 12px;
}
.shopping-item label { flex: 1; }
.shopping-item input[type="checkbox"] { transform: scale(1.15); margin-right: 8px; }
.nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: var(--card-bg);
  display: flex;
  justify-content: space-around;
  padding: 10px 6px;
  border-top: 1px solid #333;
  max-width: 900px;
  margin: 0 auto;
  width: 100%;
  z-index: 30;
}
.nav-item {
  color: var(--text-dim);
  text-decoration: none;
  font-size: 0.75rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  user-select: none;
  padding: 6px 8px;
  border-radius: 8px;
}
.nav-item.active { color: var(--accent); background: rgba(52,152,219,0.06); }
.icon { font-size: 1.4rem; margin-bottom: 2px; }
h2 {
  font-size: 1.18rem;
  margin-bottom: 12px;
  color: var(--accent);
  border-left: 4px solid var(--accent);
  padding-left: 10px;
}
.controls {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 12px;
  flex-wrap: wrap;
}
.btn {
  background: transparent;
  color: var(--text-main);
  border: 1px solid #333;
  padding: 8px 10px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9rem;
}
.btn:active { transform: translateY(1px); }
.small { font-size: 0.83rem; padding: 6px 8px; }
.add-item-row { display:flex; gap:8px; margin-top:12px; }
.input {
  background: #141414;
  border: 1px solid #2b2b2b;
  padding: 8px 10px;
  border-radius: 8px;
  color: var(--text-main);
  flex: 1;
}
.footer-note { font-size: 0.82rem; color: var(--text-dim); margin-top: 10px; }

/* Day picker modal */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 200;
}
.picker {
  background: var(--card-bg);
  border: 1px solid #333;
  padding: 18px;
  width: 92%;
  max-width: 420px;
  border-radius: 12px;
  color: var(--text-main);
}
.picker h3 { margin: 0 0 10px 0; color: var(--accent); }
.picker .options { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-bottom: 12px; }
.option-btn {
  background: transparent; border: 1px solid #333; padding: 8px; border-radius: 8px; cursor: pointer; color:var(--text-main); font-size: 0.85rem;
}
.picker .date-row { display:flex; gap:8px; margin-bottom: 12px; align-items:center; }
.small-note { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 8px; }

/* Responsive */
@media (min-width: 720px) {
  .card { padding: 18px; }
  .macro-row { font-size: 0.9rem; }
}
</style>
</head>
<body>
<header>
  <div class="header-title">PERFORMANCE DASHBOARD</div>
  <button class="change-day-btn" id="changeDayBtn" title="Change day">Change day</button>
  <div class="status-bar yellow" aria-live="polite">ðŸŸ¡ 63% YELLOW RECOVERY (Rest & Tone)</div>
</header>

<main>
  <div id="daily" class="view active" role="region" aria-labelledby="dailyHeading">
    <h2 id="dailyHeading"></h2>
    <p style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 16px;">
      Goal: Maintain 40g Protein Bolus every 4 hours to overcome anabolic resistance.
    </p>

    <!-- Meal cards -->
    <div tabindex="0" class="card meal-card" data-meal-time="09:00 AM" onclick="toggleRecipe(this)" onkeydown="cardKeyToggle(event,this)">
      <div class="meal-time">09:00 AM</div>
      <div class="meal-name">Masterâ€™s Recovery Frittata</div>
      <div class="macro-row">
        <span>P: <span class="macro-val">26g</span></span>
        <span>C: <span class="macro-val">20g</span></span>
        <span>F: <span class="macro-val">20g</span></span>
      </div>
      <div class="recipe-detail">
        <strong>Ingredients:</strong> 4 Eggs, 2 cups Spinach, 1 Cherry Tomato cluster, 1/2 Banana.<br><br>
        <strong>Method:</strong> SautÃ© veggies. Whisk eggs and pour over. Cook until set. Serve with banana side.
      </div>
    </div>

    <div tabindex="0" class="card meal-card" data-meal-time="01:00 PM" onclick="toggleRecipe(this)" onkeydown="cardKeyToggle(event,this)">
      <div class="meal-time">01:00 PM</div>
      <div class="meal-name">Strength-Builder Chicken & Potato</div>
      <div class="macro-row">
        <span>P: <span class="macro-val">65g</span></span>
        <span>C: <span class="macro-val">40g</span></span>
        <span>F: <span class="macro-val">6g</span></span>
      </div>
      <div class="recipe-detail">
        <strong>Ingredients:</strong> 200g Chicken Breast, 1 Large Potato, 1 cup Spinach.<br><br>
        <strong>Method:</strong> Cube potato and roast with chicken at 400Â°F (200Â°C) for 25 mins. Serve over spinach.
      </div>
    </div>

    <div tabindex="0" class="card meal-card" data-meal-time="04:00 PM" onclick="toggleRecipe(this)" onkeydown="cardKeyToggle(event,this)">
      <div class="meal-time">04:00 PM</div>
      <div class="meal-name">Greek Yogurt & Fruit Bolus</div>
      <div class="macro-row">
        <span>P: <span class="macro-val">22g</span></span>
        <span>C: <span class="macro-val">20g</span></span>
        <span>F: <span class="macro-val">2g</span></span>
      </div>
      <div class="recipe-detail">
        <strong>Ingredients:</strong> 1 cup Plain Greek Yogurt, 1/2 cup Assorted Berries.<br><br>
        <strong>Method:</strong> Mix and enjoy. High leucine trigger for mid-day repair.
      </div>
    </div>

    <div tabindex="0" class="card meal-card" data-meal-time="07:00 PM" onclick="toggleRecipe(this)" onkeydown="cardKeyToggle(event,this)">
      <div class="meal-time">07:00 PM</div>
      <div class="meal-name">The Weightlifterâ€™s Skillet (Rest Day Mod)</div>
      <div class="macro-row">
        <span>P: <span class="macro-val">48g</span></span>
        <span>C: <span class="macro-val">8g</span></span>
        <span>F: <span class="macro-val">34g</span></span>
      </div>
      <div class="recipe-detail">
        <strong>Ingredients:</strong> 170g Ground Beef, 1 cup Spinach, 1 oz Cheese.<br><br>
        <strong>Method:</strong> Brown beef. Add spinach until wilted. Top with cheese.
      </div>
    </div>

    <div tabindex="0" class="card meal-card" data-meal-time="09:30 PM" onclick="toggleRecipe(this)" onkeydown="cardKeyToggle(event,this)">
      <div class="meal-time">09:30 PM</div>
      <div class="meal-name">Pre-Sleep Whey Isolate</div>
      <div class="macro-row">
        <span>P: <span class="macro-val">26g</span></span>
        <span>C: <span class="macro-val">4g</span></span>
        <span>F: <span class="macro-val">3g</span></span>
      </div>
      <div class="recipe-detail">
        <strong>Ingredients:</strong> 1 scoop Whey, 1 cup Almond Milk.<br><br>
        <strong>Method:</strong> Shake and drink. Prevents overnight muscle breakdown.
      </div>
    </div>

  </div>

  <div id="shopping" class="view" role="region" aria-labelledby="shoppingHeading">
    <h2 id="shoppingHeading">Weekly Groceries</h2>

    <div class="controls" aria-hidden="false">
      <button class="btn small" id="exportBtn" type="button">Export list</button>
      <button class="btn small" id="clearBtn" type="button">Clear checks</button>
      <div style="flex:1"></div>
      <div class="footer-note">Checked state is saved locally in your browser.</div>
    </div>

    <h3 style="font-size: 0.92rem; color: var(--accent); margin-top:6px;">PROTEIN</h3>
    <ul id="proteinList" class="shopping-list" aria-label="Protein items">
      <li class="shopping-item"><input type="checkbox" data-key="700g Chicken Breast" id="item-700g-Chicken"><label for="item-700g-Chicken">700g Chicken Breast</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="700g Ground Beef (90% Lean)" id="item-700g-GroundBeef"><label for="item-700g-GroundBeef">700g Ground Beef (90% Lean)</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="4 Cans Tuna (in Oil)" id="item-4-Cans-Tuna"><label for="item-4-Cans-Tuna">4 Cans Tuna (in Oil)</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="Whey Isolate Powder" id="item-Whey-Isolate"><label for="item-Whey-Isolate">Whey Isolate Powder</label></li>
    </ul>

    <h3 style="font-size: 0.92rem; color: var(--accent); margin-top:18px;">PRODUCE</h3>
    <ul id="produceList" class="shopping-list" aria-label="Produce items">
      <li class="shopping-item"><input type="checkbox" data-key="14 Bananas" id="item-14-Bananas"><label for="item-14-Bananas">14 Bananas</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="10 Large Potatoes" id="item-10-Large-Potatoes"><label for="item-10-Large-Potatoes">10 Large Potatoes</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="5 Bags Fresh Spinach" id="item-5-Bags-Spinach"><label for="item-5-Bags-Spinach">5 Bags Fresh Spinach</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="4 Pints Cherry Tomatoes" id="item-4-Pints-Cherry"><label for="item-4-Pints-Cherry">4 Pints Cherry Tomatoes</label></li>
    </ul>

    <h3 style="font-size: 0.92rem; color: var(--accent); margin-top:18px;">DAIRY & PANTRY</h3>
    <ul id="dairyList" class="shopping-list" aria-label="Dairy and pantry">
      <li class="shopping-item"><input type="checkbox" data-key="2 Dozen Eggs" id="item-2-Dozen-Eggs"><label for="item-2-Dozen-Eggs">2 Dozen Eggs</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="1kg Greek Yogurt" id="item-1kg-Greek"><label for="item-1kg-Greek">1kg Greek Yogurt</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="1 Block Cheddar Cheese" id="item-1-Block-Cheddar"><label for="item-1-Block-Cheddar">1 Block Cheddar Cheese</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="2 Boxes Pasta" id="item-2-Boxes-Pasta"><label for="item-2-Boxes-Pasta">2 Boxes Pasta</label></li>
      <li class="shopping-item"><input type="checkbox" data-key="Peanut Butter & Nuts" id="item-Peanut-Butter-Nuts"><label for="item-Peanut-Butter-Nuts">Peanut Butter & Nuts</label></li>
    </ul>

    <div class="add-item-row" aria-label="Add shopping item">
      <input id="newItemText" class="input" type="text" placeholder="Add new item to shopping list" />
      <button id="addItemBtn" class="btn small" type="button">Add</button>
    </div>

  </div>
</main>

<nav class="nav" role="navigation" aria-label="Main navigation">
  <!-- data-view attributes drive behavior. Daily will open the day picker; Shopping will show shopping -->
  <div class="nav-item" data-view="daily" role="button" tabindex="0" aria-pressed="false">
    <span class="icon">ðŸ“…</span>
    <span>DAILY PLAN</span>
  </div>
  <div class="nav-item" data-view="shopping" role="button" tabindex="0" aria-pressed="false">
    <span class="icon">ðŸ›’</span>
    <span>SHOPPING</span>
  </div>
</nav>

<!-- Day picker modal (hidden by default) -->
<div id="dayPickerBackdrop" class="modal-backdrop" style="display:none" aria-hidden="true">
  <div class="picker" role="dialog" aria-modal="true" aria-labelledby="pickerTitle">
    <h3 id="pickerTitle">Choose a day</h3>
    <div class="small-note">Quick picks â€” today and the next/previous few days:</div>
    <div class="options" id="quickOptions" aria-hidden="false"></div>

    <div class="small-note">Or pick an exact date:</div>
    <div class="date-row">
      <input id="dateInput" type="date" class="input" style="padding:8px" />
      <button id="pickDateBtn" class="btn small">Select</button>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
      <label style="font-size:0.85rem;color:var(--text-dim);display:flex;align-items:center;gap:8px;">
        <input id="dontAskAgain" type="checkbox" /> Don't ask again
      </label>
      <div>
        <button id="cancelPicker" class="btn small" style="margin-right:8px">Cancel</button>
        <button id="useToday" class="btn small">Use Today</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Date utilities ---------- */
function formatDateTitle(d) {
  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const dayName = days[d.getDay()];
  const monthName = months[d.getMonth()];
  const day = d.getDate();
  return `${dayName}, ${monthName} ${day}`;
}
function toISODate(d) { // YYYY-MM-DD
  const y = d.getFullYear();
  const m = (d.getMonth()+1).toString().padStart(2,'0');
  const day = d.getDate().toString().padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function fromISODate(iso) {
  const parts = iso.split('-').map(Number);
  return new Date(parts[0], parts[1]-1, parts[2]);
}

/* ---------- Elements & storage keys ---------- */
const dayPickerBackdrop = document.getElementById('dayPickerBackdrop');
const quickOptionsEl = document.getElementById('quickOptions');
const dateInput = document.getElementById('dateInput');
const pickDateBtn = document.getElementById('pickDateBtn');
const useTodayBtn = document.getElementById('useToday');
const cancelPickerBtn = document.getElementById('cancelPicker');
const dontAskAgainCb = document.getElementById('dontAskAgain');
const changeDayBtn = document.getElementById('changeDayBtn');

const STORAGE_DAY_KEY = 'perf_dash_selected_date_v1';
const STORAGE_SKIP_PROMPT = 'perf_dash_skip_day_prompt_v1';

/* ---------- Nav helpers ---------- */
function setActiveNav(viewId) {
  document.querySelectorAll('.nav-item').forEach(item => {
    const v = item.dataset.view;
    if (v === viewId) {
      item.classList.add('active');
      item.setAttribute('aria-pressed','true');
    } else {
      item.classList.remove('active');
      item.setAttribute('aria-pressed','false');
    }
  });
}
function showView(viewId) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  const view = document.getElementById(viewId);
  if (view) view.classList.add('active');
  setActiveNav(viewId);
}

/* ---------- Day picker logic ---------- */
function buildQuickOptions() {
  quickOptionsEl.innerHTML = '';
  const today = new Date();
  const range = 7; // previous and next range
  for (let offset = -range; offset <= range; offset++) {
    const d = new Date(today);
    d.setDate(today.getDate() + offset);
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.type = 'button';
    btn.textContent = offset === 0 ? `Today â€” ${formatDateTitle(d)}` :
                      offset === 1 ? `Tomorrow â€” ${formatDateTitle(d)}` :
                      offset === -1 ? `Yesterday â€” ${formatDateTitle(d)}` :
                      `${formatDateTitle(d)}`;
    btn.dataset.iso = toISODate(d);
    btn.addEventListener('click', () => {
      pickDay(btn.dataset.iso);
    });
    quickOptionsEl.appendChild(btn);
  }
}
function showDayPicker(alwaysShow = false) {
  const skip = localStorage.getItem(STORAGE_SKIP_PROMPT) === 'true';
  if (skip && !alwaysShow) {
    const stored = localStorage.getItem(STORAGE_DAY_KEY);
    if (stored) {
      setSelectedDate(fromISODate(stored), /*show=*/false);
      return;
    }
  }
  buildQuickOptions();
  dateInput.value = toISODate(new Date());
  dontAskAgainCb.checked = false;
  dayPickerBackdrop.style.display = 'flex';
  dayPickerBackdrop.setAttribute('aria-hidden','false');
  const firstBtn = quickOptionsEl.querySelector('.option-btn');
  if (firstBtn) firstBtn.focus();
}
function hideDayPicker() {
  dayPickerBackdrop.style.display = 'none';
  dayPickerBackdrop.setAttribute('aria-hidden','true');
}
/* When user chooses a date: set it, save, hide picker and show daily view */
function setSelectedDate(dateObj, show=true) {
  if (!(dateObj instanceof Date) || isNaN(dateObj)) return;
  const heading = document.getElementById('dailyHeading');
  heading.textContent = formatDateTitle(dateObj);
  localStorage.setItem(STORAGE_DAY_KEY, toISODate(dateObj));
  if (dontAskAgainCb.checked) {
    localStorage.setItem(STORAGE_SKIP_PROMPT, 'true');
  }
  hideDayPicker();
  if (show) showView('daily');
}
function pickDay(isoDateStr) {
  const d = fromISODate(isoDateStr);
  setSelectedDate(d, /*show=*/true);
}
function cancelPicker() {
  hideDayPicker();
  const stored = localStorage.getItem(STORAGE_DAY_KEY);
  if (stored) {
    setSelectedDate(fromISODate(stored), /*show=*/true);
  } else {
    setSelectedDate(new Date(), /*show=*/true);
  }
}

/* ---------- Wire up picker controls ---------- */
pickDateBtn.addEventListener('click', () => {
  const iso = dateInput.value;
  if (!iso) return;
  pickDay(iso);
});
useTodayBtn.addEventListener('click', () => {
  pickDay(toISODate(new Date()));
});
cancelPickerBtn.addEventListener('click', cancelPicker);
dayPickerBackdrop.addEventListener('click', (e) => {
  if (e.target === dayPickerBackdrop) cancelPicker();
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && dayPickerBackdrop.style.display === 'flex') {
    cancelPicker();
  }
});
changeDayBtn.addEventListener('click', () => showDayPicker(true));

/* ---------- Nav item behavior ---------- */
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', (e) => {
    const view = item.dataset.view;
    if (view === 'daily') {
      // show day picker (force) so user can pick date
      showDayPicker(true);
    } else {
      // show shopping or other view directly
      showView(view);
    }
  });
  item.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      item.click();
    }
  });
});

/* ---------- Initialization: show day picker first ---------- */
(function initDaySelection() {
  const skip = localStorage.getItem(STORAGE_SKIP_PROMPT) === 'true';
  if (skip) {
    const stored = localStorage.getItem(STORAGE_DAY_KEY);
    if (stored) {
      setSelectedDate(fromISODate(stored), /*show=*/true);
    } else {
      setSelectedDate(new Date(), /*show=*/true);
    }
  } else {
    showDayPicker(false);
  }
})();

/* ---------- The rest of your app logic (kept intact) ---------- */

/* Recipe toggle */
function toggleRecipe(cardEl) {
  if (!cardEl) return;
  const detail = cardEl.querySelector('.recipe-detail');
  if (!detail) return;
  detail.classList.toggle('show');
  const expanded = detail.classList.contains('show');
  cardEl.setAttribute('aria-expanded', expanded ? 'true' : 'false');
}
function cardKeyToggle(e, cardEl) {
  if (!cardEl) return;
  const code = e.key;
  if (code === 'Enter' || code === ' ') {
    e.preventDefault();
    toggleRecipe(cardEl);
  }
}

/* Shopping list persistence */
const STORAGE_KEY = 'performance_dashboard_shopping_checked_v1';
function loadChecks() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const obj = JSON.parse(raw);
    document.querySelectorAll('#shopping input[type="checkbox"]').forEach(cb => {
      const key = cb.dataset.key || cb.id;
      cb.checked = !!obj[key];
    });
  } catch (err) {
    console.warn('Could not load shopping state', err);
  }
}
function saveChecks() {
  try {
    const obj = {};
    document.querySelectorAll('#shopping input[type="checkbox"]').forEach(cb => {
      const key = cb.dataset.key || cb.id;
      obj[key] = !!cb.checked;
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
  } catch (err) {
    console.warn('Could not save shopping state', err);
  }
}
document.querySelectorAll('#shopping input[type="checkbox"]').forEach(cb => {
  cb.addEventListener('change', saveChecks);
});
document.getElementById('clearBtn').addEventListener('click', () => {
  document.querySelectorAll('#shopping input[type="checkbox"]').forEach(cb => cb.checked = false);
  saveChecks();
});
document.getElementById('exportBtn').addEventListener('click', () => {
  const lines = [];
  document.querySelectorAll('#shopping .shopping-item').forEach(li => {
    const cb = li.querySelector('input[type="checkbox"]');
    const label = li.querySelector('label')?.textContent?.trim() || '';
    const status = cb && cb.checked ? '[x]' : '[ ]';
    lines.push(`${status} ${label}`);
  });
  const blob = new Blob([lines.join('\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `shopping-list-${(new Date()).toISOString().slice(0,10)}.txt`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

/* Add new shopping item */
document.getElementById('addItemBtn').addEventListener('click', () => {
  const input = document.getElementById('newItemText');
  const text = (input.value || '').trim();
  if (!text) return;
  addShoppingItem(text);
  input.value = '';
  input.focus();
  saveChecks();
});
document.getElementById('newItemText').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    document.getElementById('addItemBtn').click();
  }
});
function addShoppingItem(text) {
  const id = 'item-' + text.replace(/[^a-z0-9]+/ig,'-');
  const li = document.createElement('li');
  li.className = 'shopping-item';
  const cb = document.createElement('input');
  cb.type = 'checkbox';
  cb.dataset.key = text;
  cb.id = id;
  cb.addEventListener('change', saveChecks);
  const label = document.createElement('label');
  label.setAttribute('for', id);
  label.textContent = text;
  li.appendChild(cb);
  li.appendChild(label);
  document.getElementById('dairyList').appendChild(li);
  loadChecks();
}
loadChecks();

/* small accessibility: ensure cards reflect aria-expanded */
document.querySelectorAll('.card.meal-card').forEach(card => {
  const detail = card.querySelector('.recipe-detail');
  card.setAttribute('role', 'button');
  card.setAttribute('aria-expanded', detail && detail.classList.contains('show') ? 'true' : 'false');
});
</script>
</body>
</html>