<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>7-Day Olympic Performance Hub v4.0</title>
<meta name="description" content="Weekly meal calendar, recipes and shopping list for an Olympic weightlifter." />
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#07131b">
<style>
/* ====== Elite Dark Performance Theme ====== */
:root{
  --bg:#07131b;
  --panel:#0e1620;
  --panel-2:#121923;
  --muted:#9fb0bb;
  --text:#e8f2f7;
  --accent:#2ed07a;
  --accent-2:#f3a712;
  --glass: rgba(255,255,255,0.03);
  --border: rgba(255,255,255,0.04);
  --radius:14px;
  --maxw:1100px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#061018 0%, #07131b 100%);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial; -webkit-font-smoothing:antialiased}
.container{max-width:var(--maxw);margin:20px auto;padding:18px}
.header{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
.brand{display:flex;flex-direction:column;gap:6px}
.title{font-size:1.15rem;font-weight:800;letter-spacing:0.3px}
.profile{color:var(--muted);font-size:0.9rem}
.status{display:flex;flex-direction:column;align-items:flex-end;gap:8px}
.pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:linear-gradient(90deg, rgba(46,208,122,0.07), rgba(243,167,18,0.03));border:1px solid var(--border);font-weight:700;color:var(--text);font-size:0.95rem}
.quick-nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
.nav-link{background:transparent;border:1px solid var(--border);padding:8px 10px;border-radius:10px;color:var(--muted);text-decoration:none;font-weight:700;font-size:0.88rem}
.nav-link:hover{color:var(--text);transform:translateY(-2px);background:rgba(255,255,255,0.01)}
.layout{display:grid;gap:14px;grid-template-columns:1fr}
@media(min-width:980px){ .layout{grid-template-columns: 2fr 420px} }

/* cards */
.card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:var(--radius);border:1px solid var(--border);padding:14px;box-shadow:0 8px 28px rgba(0,0,0,0.6)}
.section-title{display:inline-block;padding-left:10px;border-left:4px solid var(--accent);color:var(--accent);font-weight:800;margin-bottom:8px}
.small{color:var(--muted);font-size:0.92rem}
.day{margin-bottom:12px;border-radius:10px;overflow:hidden}
.day-header{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);cursor:pointer;gap:12px}
.day-header strong{font-size:0.98rem}
.day-meta{color:var(--muted);font-size:0.86rem}
.badge{background:var(--accent-2);color:#111;padding:6px 10px;border-radius:999px;font-weight:800}

/* table style */
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th{color:var(--accent);text-align:left;padding:8px 6px;font-size:0.86rem;border-bottom:1px solid rgba(255,255,255,0.02)}
.table td{padding:8px 6px;border-bottom:1px dashed rgba(255,255,255,0.02);color:var(--muted);font-size:0.92rem}

/* expanded content */
.expand{display:none;padding-top:10px;color:var(--muted)}

/* right column shopping */
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
.btn{background:transparent;border:1px solid var(--border);padding:8px 10px;border-radius:10px;color:var(--text);cursor:pointer;font-weight:700}
.btn.primary{background:linear-gradient(90deg,var(--accent), #18c66b);color:#021a11;border:none}
.shopping-list{list-style:none;padding:0;margin:0}
.shopping-list li{display:flex;align-items:center;padding:12px;border-radius:10px;border:1px solid transparent;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))}
.shopping-list input{transform:scale(1.05);margin-right:12px}

/* picker modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:300}
.picker{background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:12px;padding:16px;border:1px solid var(--border);width:92%;max-width:420px}
.option-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.option-btn{background:transparent;border:1px solid var(--border);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}

/* footer */
.footer{margin-top:18px;color:var(--muted);font-size:0.88rem}

/* helpers */
.kbd{background:#07131b;border:1px solid var(--border);padding:4px 6px;border-radius:6px;font-size:0.85rem}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="brand">
      <div class="title">üì± 7-Day Olympic Performance Hub v4.0</div>
      <div class="profile small">Athlete: <strong>56 Years</strong> | <strong>93kg</strong> | <strong>179cm</strong> ‚Ä¢ Goal: Strength & Muscle Toning</div>
    </div>
    <div class="status">
      <div class="pill">üü° Yellow Recovery (63%) &nbsp;|&nbsp; Thursday (Rest Day)</div>
      <div style="margin-top:6px">
        <button id="changeDayBtn" class="btn">Change Selected Day</button>
      </div>
    </div>
  </header>

  <nav class="quick-nav" aria-label="Quick navigation">
    <a class="nav-link" href="#shopping">üõí SHOPPING</a>
    <a class="nav-link" href="#mon-tue">üü° MON-TUE</a>
    <a class="nav-link" href="#wednesday">üü¢ WED</a>
    <a class="nav-link" href="#thursday">üü° THU</a>
    <a class="nav-link" href="#friday">üü¢ FRI</a>
    <a class="nav-link" href="#saturday">üü° SAT</a>
    <a class="nav-link" href="#sunday">üîµ SUN</a>
  </nav>

  <main class="layout" role="main">
    <!-- left: calendar + recipes -->
    <section class="card left">
      <div class="section-title">üìÖ DAILY PLANS & RECIPES</div>

      <!-- MONDAY & TUESDAY -->
      <article id="mon-tue" class="day" data-day="MonTue">
        <div class="day-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleDay(this)">
          <div>
            <strong>üü° MONDAY & TUESDAY | High Intensity (3 PM Training)</strong>
            <div class="day-meta small">Focus: 35‚Äì40g Protein every ~4 hours to overcome anabolic resistance</div>
          </div>
          <div class="badge">High Intensity</div>
        </div>
        <div class="expand">
          <table class="table" aria-label="Mon Tue meals">
            <thead><tr><th>Time</th><th>Meal</th><th>Recipe</th><th>Macros</th></tr></thead>
            <tbody>
              <tr><td>08:30</td><td>Master‚Äôs Recovery Frittata</td><td>Saut√© tomatoes & spinach; whisk 4 eggs with almond milk; cook; serve with ¬Ω banana</td><td>35g P / 20g C / 22g F</td></tr>
              <tr><td>12:30</td><td>Pre-Tr Chicken & Oat Bowl</td><td>1 cup savory oats + 170g chicken + tomatoes</td><td>55g P / 54g C / 8g F</td></tr>
              <tr><td>17:00</td><td>Post-Tr Whey Shake</td><td>1.5 scoops whey + 1 banana</td><td>~40g P / 45g C / 2g F</td></tr>
              <tr><td>19:30</td><td>Strength Beef & Pasta Skillet</td><td>Brown 170g beef; toss with 100g pasta & sauce; top with 1oz cheese</td><td>~48g P / 80g C / 28g F</td></tr>
              <tr><td>22:00</td><td>Pre-Sleep Yogurt Bolus</td><td>1 cup Greek yogurt + pecans</td><td>~22g P / 10g C / 18g F</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- WEDNESDAY -->
      <article id="wednesday" class="day" data-day="Wed">
        <div class="day-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleDay(this)">
          <div>
            <strong>üü¢ WEDNESDAY | Restricted Day (3 PM Training)</strong>
            <div class="day-meta small">Focus: Tuna and Savory Whey integration (meatless emphasis)</div>
          </div>
          <div class="badge" style="background:var(--accent)">Restricted</div>
        </div>
        <div class="expand">
          <table class="table" aria-label="Wednesday meals">
            <thead><tr><th>Time</th><th>Meal</th><th>Recipe</th><th>Macros</th></tr></thead>
            <tbody>
              <tr><td>08:30</td><td>Protein Oats</td><td>Cook oats in almond milk; whisk in 1.5 scoops whey; top with PB</td><td>~45g P / 55g C / 12g F</td></tr>
              <tr><td>12:30</td><td>Pre-Tr Tuna & Potato Roast</td><td>Roast 2 cubed potatoes; mix with 1 can tuna & spinach</td><td>~42g P / 65g C / 12g F</td></tr>
              <tr><td>17:00</td><td>Post-Tr Recovery Shake</td><td>1.5 scoops whey + 1 cup fruit</td><td>~38g P / 30g C / 2g F</td></tr>
              <tr><td>19:30</td><td>Savory Tuna Marinara</td><td>Heat sauce LOW; whisk whey into cold water & stir into sauce; toss with 100g pasta + 1 can tuna</td><td>~50g P / 80g C / 18g F</td></tr>
              <tr><td>22:00</td><td>Night Repair</td><td>Handful pistachios + almond milk</td><td>~10g P / 5g C / 15g F</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- THURSDAY -->
      <article id="thursday" class="day" data-day="Thu">
        <div class="day-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleDay(this)">
          <div>
            <strong>üü° THURSDAY | Rest & Tone (Today)</strong>
            <div class="day-meta small">Focus: Lower calories for body recomposition</div>
          </div>
          <div class="badge">Rest</div>
        </div>
        <div class="expand">
          <table class="table" aria-label="Thursday meals">
            <thead><tr><th>Time</th><th>Meal</th><th>Recipe</th><th>Notes</th></tr></thead>
            <tbody>
              <tr><td>09:00</td><td>Toning Frittata</td><td>4 eggs, spinach, tomatoes (no potato)</td><td>Lower carbs</td></tr>
              <tr><td>13:00</td><td>Lean Chicken Roast</td><td>Chicken + spinach + tomatoes</td><td>High protein</td></tr>
              <tr><td>16:30</td><td>Yogurt & Almond Snack</td><td>Greek yogurt + almonds</td><td>Protein-rich snack</td></tr>
              <tr><td>19:30</td><td>Ground Beef Skillet</td><td>Beef & extra spinach (no potato)</td><td>Low carbs</td></tr>
              <tr><td>21:30</td><td>Night Repair Shake</td><td>Whey in water</td><td>Slow overnight recovery</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- FRIDAY -->
      <article id="friday" class="day" data-day="Fri">
        <div class="day-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleDay(this)">
          <div>
            <strong>üü¢ FRIDAY | Restricted / Saturday Load (3 PM Training)</strong>
            <div class="day-meta small">Focus: Carbohydrate load for tomorrow's morning session</div>
          </div>
          <div class="badge" style="background:var(--accent)">Load</div>
        </div>
        <div class="expand">
          <table class="table" aria-label="Friday meals">
            <thead><tr><th>Time</th><th>Meal</th><th>Recipe</th><th>Macros</th></tr></thead>
            <tbody>
              <tr><td>08:30</td><td>Fruit & Whey Smoothie</td><td>Whey + oats + banana + almond milk</td><td>~45g P / 65g C / 8g F</td></tr>
              <tr><td>12:30</td><td>Peanut Noodle Bowl</td><td>Pasta + 2 tbsp PB + spinach</td><td>~20g P / 75g C / 18g F</td></tr>
              <tr><td>17:00</td><td>Recovery Bolus</td><td>1.5 scoops whey + banana</td><td>~38g P / 30g C</td></tr>
              <tr><td>19:30</td><td>The Glycogen Load</td><td>Double pasta + 1 can tuna + whey-marinara + 1 potato</td><td>~58g P / 140g C / 20g F</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- SATURDAY -->
      <article id="saturday" class="day" data-day="Sat">
        <div class="day-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleDay(this)">
          <div>
            <strong>üü° SATURDAY | Peak Power (9 AM Training)</strong>
            <div class="day-meta small">Focus: Rapid energy for explosive lifting</div>
          </div>
          <div class="badge">Peak</div>
        </div>
        <div class="expand">
          <table class="table" aria-label="Saturday meals">
            <thead><tr><th>Time</th><th>Meal</th><th>Recipe</th></tr></thead>
            <tbody>
              <tr><td>07:30</td><td>Pre-Session Liquid Fuel</td><td>1 scoop whey + banana blended</td></tr>
              <tr><td>11:00</td><td>Recovery Brunch Skillet</td><td>4 eggs, 2 potatoes, cheese, spinach</td></tr>
              <tr><td>14:30</td><td>Power Lunch</td><td>150g chicken + yogurt + fruit</td></tr>
              <tr><td>18:30</td><td>Hypertrophy Dinner</td><td>Beef & pasta skillet, cheese</td></tr>
              <tr><td>21:30</td><td>Night Repair</td><td>Mixed nuts + milk</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- SUNDAY -->
      <article id="sunday" class="day" data-day="Sun">
        <div class="day-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleDay(this)">
          <div>
            <strong>üîµ SUNDAY | Systemic Reset (Rest Day)</strong>
            <div class="day-meta small">Focus: Omega-3s & minerals for CNS recovery</div>
          </div>
          <div class="badge" style="background:#41a3ff">Reset</div>
        </div>
        <div class="expand">
          <table class="table" aria-label="Sunday meals">
            <thead><tr><th>Time</th><th>Meal</th><th>Recipe</th></tr></thead>
            <tbody>
              <tr><td>09:30</td><td>Eggs & Fruit Plate</td><td>Eggs + assorted fruit</td></tr>
              <tr><td>13:30</td><td>Omega Tuna Salad</td><td>2 cans tuna + tomatoes + spinach + walnuts</td></tr>
              <tr><td>16:30</td><td>PB & Banana Snack</td><td>Peanut butter + banana</td></tr>
              <tr><td>19:30</td><td>Lean Chicken Roast</td><td>Roast chicken + veg</td></tr>
              <tr><td>22:00</td><td>Pre-Sleep Whey & Pecans</td><td>Whey + pecans</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- WHOOP Auto-Reg section -->
      <section class="card" style="margin-top:12px">
        <div class="section-title">‚öôÔ∏è WHOOP AUTO-REGULATION ENGINE</div>
        <div class="small" style="margin-top:8px">
          <ul>
            <li>üü¢ <strong>Green Recovery &gt;67%</strong>: Add 25g carbs to Post-Workout meal.</li>
            <li>üî¥ <strong>Red Recovery &lt;33%</strong>: Decrease volume 20% and increase healthy fats by 15g.</li>
          </ul>
        </div>
      </section>
    </section>

    <!-- right: shopping & controls -->
    <aside class="card right" style="min-width:280px">
      <div class="section-title">üõí WEEKLY SHOPPING LIST</div>
      <div class="small" style="margin-bottom:10px">Quantities calibrated for a 93kg athlete (5 high-intensity sessions)</div>

      <div class="controls">
        <button id="clearChecks" class="btn">Clear</button>
        <button id="exportList" class="btn primary">Export .txt</button>
        <div style="flex:1"></div>
        <button id="openPicker" class="btn">Select Day</button>
      </div>

      <div style="margin-top:8px">
        <div class="small" style="margin-bottom:6px"><strong>ü•© PROTEINS</strong></div>
        <ul class="shopping-list" id="proteins">
          <li><input type="checkbox" data-key="Chicken Breast"> Chicken Breast: 800g (Skinless)</li>
          <li><input type="checkbox" data-key="Ground Beef"> Ground Beef: 700g (90% Lean)</li>
          <li><input type="checkbox" data-key="Canned Tuna"> Canned Tuna (Olive Oil): 6 Cans</li>
          <li><input type="checkbox" data-key="Eggs"> Eggs: 2 Dozen (Large)</li>
          <li><input type="checkbox" data-key="Whey"> Whey Isolate: 1 Large Tub</li>
          <li><input type="checkbox" data-key="Greek Yogurt"> Greek Yogurt: 1.5kg</li>
        </ul>
      </div>

      <div style="margin-top:12px">
        <div class="small" style="margin-bottom:6px"><strong>ü•¶ PRODUCE</strong></div>
        <ul class="shopping-list" id="produce">
          <li><input type="checkbox" data-key="Bananas"> Bananas: 14</li>
          <li><input type="checkbox" data-key="Potatoes"> Potatoes: 12</li>
          <li><input type="checkbox" data-key="Spinach"> Spinach: 7 Bags</li>
          <li><input type="checkbox" data-key="Cherry Tomatoes"> Cherry Tomatoes: 4 Pints</li>
          <li><input type="checkbox" data-key="Assorted Fruits"> Assorted Fruits: 4 Packs</li>
        </ul>
      </div>

      <div style="margin-top:12px">
        <div class="small" style="margin-bottom:6px"><strong>ü•õ DAIRY & PANTRY</strong></div>
        <ul class="shopping-list" id="pantry">
          <li><input type="checkbox" data-key="Cheese"> Cheese: 250g Block</li>
          <li><input type="checkbox" data-key="Almond Milk"> Almond Milk: 4 L</li>
          <li><input type="checkbox" data-key="Rolled Oats"> Rolled Oats: 1kg</li>
          <li><input type="checkbox" data-key="Pasta"> Pasta: 2 Boxes</li>
          <li><input type="checkbox" data-key="Tomato Sauce"> Tomato Sauce: 4 Jars</li>
          <li><input type="checkbox" data-key="Nuts"> Nuts: Almonds/Pecans/Pistachios</li>
        </ul>
      </div>

      <div class="footer small">Tip: Use Export to save a plain-text shopping list. Install via Safari ‚Üí Share ‚Üí Add to Home Screen.</div>
    </aside>
  </main>
</div>

<!-- Day-picker modal -->
<div id="dayPicker" class="modal-backdrop" aria-hidden="true">
  <div class="picker" role="dialog" aria-modal="true" aria-labelledby="pickerTitle">
    <h3 id="pickerTitle" style="margin:0 0 10px 0">Choose a date</h3>
    <div class="small" style="margin-bottom:8px">Quick picks (today ¬±3)</div>
    <div id="quickGrid" class="option-grid" style="margin-bottom:12px"></div>
    <div style="display:flex;gap:8px;margin-bottom:12px">
      <input id="pickerDate" type="date" style="flex:1;padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)">
      <button id="pickBtn" class="btn primary">Select</button>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <label style="color:var(--muted);font-size:0.9rem"><input id="dontAsk" type="checkbox"> Don't ask again</label>
      <div>
        <button id="closePicker" class="btn">Cancel</button>
        <button id="todayBtn" class="btn">Use Today</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Utilities ---------- */
function $(sel, root=document){ return root.querySelector(sel); }
function $all(sel, root=document){ return Array.from((root||document).querySelectorAll(sel)); }
function formatDate(d){ const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat']; const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; return `${days[d.getDay()]} ${months[d.getMonth()]} ${d.getDate()}`; }
function toISO(d){ const y=d.getFullYear(); const m=('0'+(d.getMonth()+1)).slice(-2); const day=('0'+d.getDate()).slice(-2); return `${y}-${m}-${day}`; }
function fromISO(s){ const [y,m,d]=s.split('-').map(Number); return new Date(y,m-1,d); }

/* ---------- Expand/collapse day sections ---------- */
function toggleDay(btn){
  const article = btn.closest('.day');
  const exp = btn.getAttribute('aria-expanded') === 'true';
  // collapse others
  $all('.expand').forEach(el=>el.style.display='none');
  $all('.day-header').forEach(h=>h.setAttribute('aria-expanded','false'));
  if(!exp){
    article.querySelector('.expand').style.display='block';
    btn.setAttribute('aria-expanded','true');
    article.scrollIntoView({behavior:'smooth', block:'center'});
  } else {
    article.querySelector('.expand').style.display='none';
    btn.setAttribute('aria-expanded','false');
  }
}
// keyboard support
$all('.day-header').forEach(h=>{
  h.addEventListener('keydown', e=>{
    if(e.key==='Enter' || e.key===' ') { e.preventDefault(); toggleDay(h); }
  });
});

/* ---------- Shopping list persistence & export ---------- */
const SHOP_KEY = 'olympic_hub_shopping_v1';
function loadChecks(){
  try{
    const raw = localStorage.getItem(SHOP_KEY);
    if(!raw) return;
    const obj = JSON.parse(raw);
    $all('.shopping-list input[type="checkbox"]').forEach(cb=>{
      const k = cb.dataset.key || cb.id;
      cb.checked = !!obj[k];
    });
  }catch(e){ console.warn(e); }
}
function saveChecks(){
  try{
    const obj={};
    $all('.shopping-list input[type="checkbox"]').forEach(cb=>{
      const k = cb.dataset.key || cb.id;
      obj[k] = !!cb.checked;
    });
    localStorage.setItem(SHOP_KEY, JSON.stringify(obj));
  }catch(e){ console.warn(e); }
}
$all('.shopping-list input[type="checkbox"]').forEach(cb=>cb.addEventListener('change', saveChecks));
$('#clearChecks').addEventListener('click', ()=>{
  $all('.shopping-list input[type="checkbox"]').forEach(cb=>cb.checked=false);
  saveChecks();
});
$('#exportList').addEventListener('click', ()=>{
  const lines=[];
  $all('.shopping-list').forEach(list=>{
    list.querySelectorAll('li').forEach(li=>{
      const cb = li.querySelector('input[type="checkbox"]');
      const txt = li.textContent.trim();
      const status = cb && cb.checked ? '[x]' : '[ ]';
      lines.push(`${status} ${txt}`);
    });
  });
  const blob = new Blob([lines.join('\\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=`shopping-${(new Date()).toISOString().slice(0,10)}.txt`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* ---------- Day-picker modal ---------- */
const DAY_KEY = 'olympic_hub_selected_date_v1';
const SKIP_KEY = 'olympic_hub_skip_picker_v1';
const pickerBackdrop = $('#dayPicker');
const quickGrid = $('#quickGrid');
const pickerDate = $('#pickerDate');
const pickBtn = $('#pickBtn');
const closePicker = $('#closePicker');
const todayBtn = $('#todayBtn');
const dontAsk = $('#dontAsk');
const changeDayBtn = $('#changeDayBtn');

function buildQuick(){
  quickGrid.innerHTML='';
  const today = new Date();
  for(let i=-3;i<=3;i++){
    const d = new Date(today); d.setDate(today.getDate()+i);
    const btn = document.createElement('button');
    btn.type='button';
    btn.className='option-btn';
    btn.textContent = i===0 ? `Today ‚Ä¢ ${formatDate(d)}` : (i===1?`Tomorrow ‚Ä¢ ${formatDate(d)}`:(i===-1?`Yesterday ‚Ä¢ ${formatDate(d)}`:formatDate(d)));
    btn.dataset.iso = toISO(d);
    btn.addEventListener('click', ()=> selectDate(btn.dataset.iso));
    quickGrid.appendChild(btn);
  }
}

function showPicker(force=false){
  const skip = localStorage.getItem(SKIP_KEY) === 'true';
  if(skip && !force){
    const stored = localStorage.getItem(DAY_KEY);
    if(stored) applySelectedDate(fromISO(stored));
    return;
  }
  buildQuick();
  pickerDate.value = toISO(new Date());
  dontAsk.checked = false;
  pickerBackdrop.style.display='flex';
  pickerBackdrop.setAttribute('aria-hidden','false');
  quickGrid.querySelector('button')?.focus();
}
function hidePicker(){ pickerBackdrop.style.display='none'; pickerBackdrop.setAttribute('aria-hidden','true'); }

function applySelectedDate(d){
  if(!(d instanceof Date) || isNaN(d)) return;
  // show in header pill
  $('.pill').textContent = `üü° Yellow Recovery (63%) ‚Ä¢ Selected: ${formatDate(d)}`;
  // persist
  localStorage.setItem(DAY_KEY, toISO(d));
  // if checked, persist skip
  if(dontAsk.checked) localStorage.setItem(SKIP_KEY,'true');
  // expand appropriate day
  expandForDate(d);
  hidePicker();
}

function selectDate(iso){ applySelectedDate(fromISO(iso)); }

pickBtn.addEventListener('click', ()=>{ if(pickerDate.value) selectDate(pickerDate.value); });
todayBtn.addEventListener('click', ()=> selectDate(toISO(new Date())));
closePicker.addEventListener('click', ()=> { hidePicker(); const stored = localStorage.getItem(DAY_KEY); if(stored) applySelectedDate(fromISO(stored)); });
pickerBackdrop.addEventListener('click', (e)=>{ if(e.target === pickerBackdrop) closePicker.click(); });
changeDayBtn.addEventListener('click', ()=> showPicker(true));

function weekdayToAttr(d){
  const wd = d.getDay();
  switch(wd){
    case 1: return 'MonTue';
    case 2: return 'MonTue';
    case 3: return 'Wed';
    case 4: return 'Thu';
    case 5: return 'Fri';
    case 6: return 'Sat';
    case 0: return 'Sun';
    default: return 'MonTue';
  }
}

function expandForDate(d){
  const attr = weekdayToAttr(d);
  // collapse all
  $all('.expand').forEach(el=>el.style.display='none');
  $all('.day-header').forEach(h=>h.setAttribute('aria-expanded','false'));
  const article = document.querySelector(`.day[data-day="${attr}"]`);
  if(article){
    article.querySelector('.expand').style.display='block';
    article.querySelector('.day-header').setAttribute('aria-expanded','true');
    setTimeout(()=> article.scrollIntoView({behavior:'smooth', block:'center'}), 120);
  }
}

/* ---------- init ---------- */
(function init(){
  // make day headers keyboard accessible
  $all('.day-header').forEach(h=>{ h.setAttribute('tabindex','0'); h.setAttribute('role','button'); });
  loadChecks();

  // if stored selected date + skip => apply; else show picker
  const skip = localStorage.getItem(SKIP_KEY) === 'true';
  const stored = localStorage.getItem(DAY_KEY);
  if(stored && skip){ applySelectedDate(fromISO(stored)); }
  else if(stored && !skip){ // prefill and show
    $('.pill').textContent = `üü° Yellow Recovery (63%) ‚Ä¢ Selected: ${formatDate(fromISO(stored))}`;
    showPicker(false);
  } else {
    showPicker(false);
  }
})();

/* ---------- Service Worker registration (optional) ---------- */
if('serviceWorker' in navigator){
  window.addEventListener('load', async ()=>{
    try{ await navigator.serviceWorker.register('/sw.js'); console.log('SW registered'); } catch(e){ console.warn('SW failed', e); }
  });
}
</script>
</body>
</html>