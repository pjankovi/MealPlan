<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Performance Dashboard</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#121212">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<style>
:root {
  --whoop-yellow: #f1c40f;
  --bg-dark: #121212;
  --card-bg: #1e1e1e;
  --text-main: #ffffff;
  --text-dim: #b3b3b3;
  --accent: #3498db;
}
* { box-sizing: border-box; }
html,body { height: 100%; margin:0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: var(--bg-dark);
  color: var(--text-main);
  display:flex;
  flex-direction:column;
  min-height:100vh;
}
header { padding:14px 18px; background:var(--card-bg); border-bottom:1px solid #333; position:relative; text-align:center; }
.header-title { font-weight:700; letter-spacing:1px; }
.change-day-btn { position:absolute; right:12px; top:12px; background:transparent; border:1px solid #333; color:var(--text-dim); padding:6px 8px; border-radius:8px; cursor:pointer; }
.status-bar {display:inline-block;margin-top:8px;padding:6px 12px;border-radius:18px;background:rgba(241,196,15,0.12); color:var(--whoop-yellow); font-weight:700; border:1px solid rgba(241,196,15,0.25);}

/* layout */
main { flex:1; padding:16px; max-width:900px; margin:0 auto; width:100%; padding-bottom:110px; overflow:auto; }
.view { display:none; }
.view.active { display:block; }

/* cards + styles (kept lean) */
.card { background:var(--card-bg); border-radius:10px; padding:14px; margin-bottom:12px; border:1px solid #333; cursor:pointer; }
.meal-time { color:var(--text-dim); font-size:0.78rem; margin-bottom:6px; }
.meal-name { font-weight:700; margin-bottom:8px; }
.macro-row { display:flex; justify-content:space-between; border-top:1px solid #333; padding-top:10px; color:var(--text-dim); }
.recipe-detail { display:none; color:var(--text-dim); margin-top:10px; border-top:1px dashed #444; padding-top:10px; }
.recipe-detail.show { display:block; }

.nav { position:fixed; left:0; right:0; bottom:0; background:var(--card-bg); border-top:1px solid #333; display:flex; justify-content:space-around; padding:10px 6px; z-index:30; }
.nav-item { color:var(--text-dim); text-align:center; cursor:pointer; padding:6px 8px; border-radius:8px; }
.nav-item.active { color:var(--accent); background: rgba(52,152,219,0.06); }
.icon{ font-size:1.4rem; }

.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:200; }
.picker { background:var(--card-bg); padding:16px; border-radius:10px; border:1px solid #333; width:92%; max-width:440px; color:var(--text-main); }
.option-btn { padding:8px; border-radius:8px; border:1px solid #333; background:transparent; color:var(--text-main); cursor:pointer; font-size:0.88rem; }

/* accessibility */
[role="button"] { outline: none; }
</style>
</head>
<body>
<header>
  <div class="header-title">PERFORMANCE DASHBOARD</div>
  <button class="change-day-btn" id="changeDayBtn">Change day</button>
  <div class="status-bar" aria-live="polite">ðŸŸ¡ 63% YELLOW RECOVERY (Rest & Tone)</div>
</header>

<main>
  <div id="daily" class="view active" role="region" aria-labelledby="dailyHeading">
    <h2 id="dailyHeading"></h2>
    <p style="color:var(--text-dim); margin-top:6px;">Goal: Maintain 40g Protein Bolus every 4 hours to overcome anabolic resistance.</p>

    <!-- sample cards -->
    <div tabindex="0" class="card meal-card" onclick="toggleRecipe(this)" onkeydown="cardKeyToggle(event,this)">
      <div class="meal-time">09:00 AM</div>
      <div class="meal-name">Masterâ€™s Recovery Frittata</div>
      <div class="macro-row"><span>P: <strong>26g</strong></span><span>C: <strong>20g</strong></span><span>F: <strong>20g</strong></span></div>
      <div class="recipe-detail"><strong>Ingredients:</strong> 4 Eggs, 2 cups Spinach, 1 Cherry Tomato, 1/2 Banana.<br><br><strong>Method:</strong> SautÃ© veggies. Whisk eggs and pour over. Serve with banana.</div>
    </div>
    <!-- more cards omitted for brevity; re-add your full cards here if needed -->
  </div>

  <div id="shopping" class="view" role="region" aria-labelledby="shoppingHeading">
    <h2 id="shoppingHeading">Weekly Groceries</h2>
    <p style="color:var(--text-dim)">Checked state is stored locally.</p>
    <ul class="shopping-list">
      <li class="card"><input type="checkbox" id="c1"><label for="c1">700g Chicken Breast</label></li>
      <li class="card"><input type="checkbox" id="c2"><label for="c2">700g Ground Beef</label></li>
    </ul>
  </div>
</main>

<nav class="nav" role="navigation" aria-label="Main navigation">
  <div class="nav-item" data-view="daily" role="button" tabindex="0"><span class="icon">ðŸ“…</span><div>DAILY</div></div>
  <div class="nav-item" data-view="shopping" role="button" tabindex="0"><span class="icon">ðŸ›’</span><div>SHOP</div></div>
</nav>

<!-- day picker modal -->
<div id="dayPickerBackdrop" class="modal-backdrop" style="display:none" aria-hidden="true">
  <div class="picker" role="dialog" aria-modal="true">
    <h3 style="color:var(--accent)">Choose a day</h3>
    <div id="quickOptions" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px"></div>
    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <input id="dateInput" type="date" style="flex:1;padding:8px;background:#141414;border:1px solid #333;color:var(--text-main)">
      <button id="pickDateBtn" class="option-btn">Select</button>
    </div>
    <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
      <button id="cancelPicker" class="option-btn">Cancel</button>
      <button id="useToday" class="option-btn">Use Today</button>
    </div>
  </div>
</div>

<noscript>
  <div style="position:fixed;left:0;right:0;top:0;background:#ffcc00;color:#000;padding:8px;text-align:center;z-index:9999;">
    JavaScript is required for this app â€” please enable JS in your browser.
  </div>
</noscript>

<script>
/* ---------- small utilities ---------- */
function formatDateTitle(d){
  const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}`;
}
function toISO(d){ const y=d.getFullYear(); const m=('0'+(d.getMonth()+1)).slice(-2); const day=('0'+d.getDate()).slice(-2); return `${y}-${m}-${day}`; }
function fromISO(s){ const p=s.split('-').map(Number); return new Date(p[0],p[1]-1,p[2]); }

/* ---------- day picker ---------- */
const dayPicker = document.getElementById('dayPickerBackdrop');
const quickOptions = document.getElementById('quickOptions');
const dateInput = document.getElementById('dateInput');
const pickDateBtn = document.getElementById('pickDateBtn');
const cancelPicker = document.getElementById('cancelPicker');
const useToday = document.getElementById('useToday');
const changeDayBtn = document.getElementById('changeDayBtn');
const STORAGE_DAY_KEY = 'perf_dash_selected_date_v1';
const STORAGE_SKIP_PROMPT = 'perf_dash_skip_day_prompt_v1';

function buildQuick(){
  quickOptions.innerHTML='';
  const today=new Date();
  for(let offset=-3; offset<=3; offset++){
    const d=new Date(today); d.setDate(today.getDate()+offset);
    const btn=document.createElement('button');
    btn.className='option-btn';
    btn.textContent = offset===0 ? `Today â€” ${formatDateTitle(d)}` : (offset===1 ? `Tomorrow â€” ${formatDateTitle(d)}` : (offset===-1 ? `Yesterday â€” ${formatDateTitle(d)}` : formatDateTitle(d)));
    btn.dataset.iso = toISO(d);
    btn.onclick = ()=>{ pickDay(btn.dataset.iso); };
    quickOptions.appendChild(btn);
  }
}

function showDayPicker(force=false){
  const skip = localStorage.getItem(STORAGE_SKIP_PROMPT) === 'true';
  if(skip && !force){
    const stored = localStorage.getItem(STORAGE_DAY_KEY);
    if(stored){ setSelectedDate(fromISO(stored)); return; }
  }
  buildQuick();
  dateInput.value = toISO(new Date());
  dayPicker.style.display='flex';
  dayPicker.setAttribute('aria-hidden','false');
}

function hideDayPicker(){ dayPicker.style.display='none'; dayPicker.setAttribute('aria-hidden','true'); }

function setSelectedDate(d){
  if(!(d instanceof Date) || isNaN(d)) return;
  document.getElementById('dailyHeading').textContent = formatDateTitle(d);
  localStorage.setItem(STORAGE_DAY_KEY, toISO(d));
  hideDayPicker();
  showView('daily');
}

function pickDay(iso){
  setSelectedDate(fromISO(iso));
}

pickDateBtn.addEventListener('click', ()=>{ if(dateInput.value) pickDay(dateInput.value); });
useToday.addEventListener('click', ()=> pickDay(toISO(new Date())));
cancelPicker.addEventListener('click', ()=>{ hideDayPicker(); const s=localStorage.getItem(STORAGE_DAY_KEY); setSelectedDate(s?fromISO(s):new Date()); });
dayPicker.addEventListener('click', (e)=>{ if(e.target===dayPicker) cancelPicker(); });
changeDayBtn.addEventListener('click', ()=> showDayPicker(true));

/* ---------- navigation ---------- */
function showView(id){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  const view=document.getElementById(id);
  if(view) view.classList.add('active');
  document.querySelectorAll('.nav-item').forEach(item=>{
    if(item.dataset.view === id){ item.classList.add('active'); } else item.classList.remove('active');
  });
}
document.querySelectorAll('.nav-item').forEach(item=>{
  item.addEventListener('click', ()=> {
    const view = item.dataset.view;
    if(view === 'daily'){ showDayPicker(true); } else { showView(view); }
  });
});

/* ---------- recipe toggle & keyboard ---------- */
function toggleRecipe(card){
  const detail = card.querySelector('.recipe-detail');
  if(!detail) return;
  detail.classList.toggle('show');
  card.setAttribute('aria-expanded', detail.classList.contains('show'));
}
function cardKeyToggle(e, card){ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); toggleRecipe(card); } }
document.querySelectorAll('.card.meal-card').forEach(c=>{ c.setAttribute('role','button'); c.setAttribute('tabindex','0'); });

/* ---------- shopping persistence (simple) ---------- */
const STORAGE_CHECKS = 'performance_dashboard_shopping_checked_v1';
function loadChecks(){ try{ const raw = localStorage.getItem(STORAGE_CHECKS); if(!raw) return; const obj = JSON.parse(raw); document.querySelectorAll('#shopping input[type="checkbox"]').forEach(cb=>{ const k = cb.dataset.key || cb.id; cb.checked = !!obj[k]; }); }catch(e){ console.warn(e); } }
function saveChecks(){ try{ const obj={}; document.querySelectorAll('#shopping input[type="checkbox"]').forEach(cb=>{ const k = cb.dataset.key || cb.id; obj[k] = !!cb.checked; }); localStorage.setItem(STORAGE_CHECKS, JSON.stringify(obj)); }catch(e){ console.warn(e); } }
document.addEventListener('change', (e)=>{ if(e.target && e.target.matches && e.target.matches('#shopping input[type="checkbox"]')) saveChecks(); });

/* ---------- initialization ---------- */
(function init(){
  // restore date if skip set
  const skip = localStorage.getItem(STORAGE_SKIP_PROMPT) === 'true';
  if(skip){
    const stored = localStorage.getItem(STORAGE_DAY_KEY);
    setSelectedDate(stored ? fromISO(stored) : new Date());
  } else {
    showDayPicker(false);
  }
  loadChecks();
})();

/* ---------- service worker registration with safe handling ---------- */
if('serviceWorker' in navigator){
  try {
    window.addEventListener('load', async () => {
      try {
        const reg = await navigator.serviceWorker.register('sw.js');
        console.log('Service worker registered', reg);
      } catch (err) {
        console.warn('Service worker registration failed:', err);
      }
    });
  } catch (err) {
    console.warn('Service worker code error', err);
  }
}
</script>
</body>
</html>